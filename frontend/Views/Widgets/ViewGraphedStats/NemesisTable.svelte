<script lang="ts">
    import PaginatedTable from "./PaginatedTable.svelte";
    import StackTracePreview from "./StackTracePreview.svelte";
    import type { NemesisData } from "./Interfaces";

    export let nemesisName: string | null;
    export let nemesisData: NemesisData[];
    export let onClose: () => void;

    $: items = nemesisName ? nemesisData.filter((n) => n.name === nemesisName) : [];

    const columns = [
        {
            key: "status",
            label: "Status",
            sort: (a: NemesisData, b: NemesisData) =>
                a.status === "failed" && b.status !== "failed"
                    ? -1
                    : a.status !== "failed" && b.status === "failed"
                    ? 1
                    : a.run_id.localeCompare(b.run_id),
            width: "120px",
            render: (item: NemesisData) =>
                `<span class="badge bg-${item.status === "failed" ? "danger" : "success"}">${
                    item.status === "failed" ? "Failed" : "Succeeded"
                }</span>`,
        },
        {
            key: "start_time",
            label: "Start Time",
            sort: (a: NemesisData, b: NemesisData) => a.start_time - b.start_time,
            width: "130px",
        },
        {
            key: "duration",
            label: "Duration",
            sort: (a: NemesisData, b: NemesisData) => a.duration - b.duration,
            width: "130px",
        },
        {
            key: "version",
            label: "Version",
            sort: (a: NemesisData, b: NemesisData) => a.version.localeCompare(b.version),
            width: "130px",
        },
        { key: "stack_trace", label: "Stack Trace", component: StackTracePreview },
    ];
    const sortField = "status";
    const sortDirection = "asc";
</script>

{#if nemesisName}
    <PaginatedTable {items} title={`Nemesis: ${nemesisName}`} {sortField} {sortDirection} {columns} {onClose} />
{/if}
